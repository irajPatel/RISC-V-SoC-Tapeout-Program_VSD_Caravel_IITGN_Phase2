# The 8 Missing Signals - VERIFIED

## Summary
The 8 control signals ARE being generated by gpio_control_block and ARE flowing through caravel_core to the mprj_io module. **BUT they are never connected to the pc3b03ed_wrapper pad cell instances.**

This is like having a power cable plugged into the wall, but not plugged into the device. The signals exist, they're just not reaching the pads.

---

## Signal Flow Path (What SHOULD Happen)

```
firmware write to 0x2600XXXX
    ‚Üì
housekeeping module decodes write
    ‚Üì
gpio_control_block.v generates:
  - pad_gpio_out
  - pad_gpio_outenb
  - pad_gpio_dm[2:0]
  - pad_gpio_inenb
  - pad_gpio_vtrip_sel    ‚Üê Signal #1
  - pad_gpio_ib_mode_sel  ‚Üê Signal #2
  - pad_gpio_slow_sel     ‚Üê Signal #3
  - pad_gpio_holdover     ‚Üê Signal #4
  - pad_gpio_ana_en       ‚Üê Signal #5
  - pad_gpio_ana_sel      ‚Üê Signal #6
  - pad_gpio_ana_pol      ‚Üê Signal #7
  - (enh is derived)      ‚Üê Signal #8
    ‚Üì
caravel_core.v connects to mprj_io:
  .pad_gpio_vtrip_sel(mprj_io_vtrip_sel[...])
  .pad_gpio_ib_mode_sel(mprj_io_ib_mode_sel[...])
  ... all 8 signals passed as module ports
    ‚Üì
mprj_io.v should connect to pad cell:
  WORKING: sky130_ef_io__gpiov2_pad_wrapped
    .VTRIP_SEL(vtrip_sel[...])    ‚úì CONNECTED
    .IB_MODE_SEL(ib_mode_sel[...]) ‚úì CONNECTED
    .SLOW(slow_sel[...])          ‚úì CONNECTED
    .HLD_OVR(holdover[...])       ‚úì CONNECTED
    .ANALOG_EN(analog_en[...])    ‚úì CONNECTED
    .ANALOG_SEL(analog_sel[...])  ‚úì CONNECTED
    .ANALOG_POL(analog_pol[...])  ‚úì CONNECTED
    .ENABLE_H(enh[...])           ‚úì CONNECTED
    ‚Üì
  Pads are properly configured
    ‚Üì
  GPIO TEST PASSES ‚úì
```

vs.

```
NOT WORKING: pc3b03ed_wrapper
  .IN(io_in[...])           ‚úì CONNECTED
  .OUT(io_out[...])         ‚úì CONNECTED
  .PAD(io[...])             ‚úì CONNECTED
  .INPUT_DIS(inp_dis[...])  ‚úì CONNECTED
  .OUT_EN_N(oeb[...])       ‚úì CONNECTED
  .dm(dm[...])              ‚úì CONNECTED
  .VTRIP_SEL(???)           ‚úó NOT CONNECTED
  .IB_MODE_SEL(???)         ‚úó NOT CONNECTED
  .SLOW(???)                ‚úó NOT CONNECTED
  .HLD_OVR(???)             ‚úó NOT CONNECTED
  .ANALOG_EN(???)           ‚úó NOT CONNECTED
  .ANALOG_SEL(???)          ‚úó NOT CONNECTED
  .ANALOG_POL(???)          ‚úó NOT CONNECTED
  .ENABLE_H(???)            ‚úó NOT CONNECTED
    ‚Üì
  Pads are unconfigured
    ‚Üì
  GPIO TEST FAILS ‚úó
```

---

## VCD Evidence: Signals ARE Toggling (But Going Nowhere)

### NOT Working Version VCD Signal Changes:
- `mprj_io_vtrip_sel`: 23,902 changes ‚ö†Ô∏è
- `mprj_io_ib_mode_sel`: 25,134 changes ‚ö†Ô∏è
- `mprj_io_slow_sel`: 48,798 changes ‚ö†Ô∏è

**These signals ARE changing!** The firmware IS writing to the control registers, and housekeeping IS generating the output signals.

But because they're not connected to the pad cell in mprj_io.v, **the pads never see these changes**.

It's like writing data to a UART transmit buffer, but the transmit pin is disconnected. The buffer toggles, but nothing comes out of the device.

---

## Code Comparison: The Missing Connections

### Working Version (`rtl/mprj_io.v`, lines ~70-115):
```verilog
sky130_ef_io__gpiov2_pad_wrapped area1_io_pad [AREA1PADS - 1:0] (
    `USER1_ABUTMENT_PINS
    `ifndef TOP_ROUTING
        .PAD(io[AREA1PADS - 1:0]),
    `endif
    .OUT(io_out[AREA1PADS - 1:0]),
    .OE_N(oeb[AREA1PADS - 1:0]),
    .HLD_H_N(loop1_io[AREA1PADS - 1:0]),
    .ENABLE_H(enh[AREA1PADS - 1:0]),              // ‚Üê CONNECTED
    .ENABLE_INP_H(loop0_io[AREA1PADS - 1:0]),
    .ENABLE_VDDA_H(porb_h),
    .ENABLE_VSWITCH_H(loop0_io[AREA1PADS - 1:0]),
    .ENABLE_VDDIO(vccd_conb[AREA1PADS - 1:0]),
    .INP_DIS(inp_dis[AREA1PADS - 1:0]),
    .IB_MODE_SEL(ib_mode_sel[AREA1PADS - 1:0]),  // ‚Üê CONNECTED
    .VTRIP_SEL(vtrip_sel[AREA1PADS - 1:0]),      // ‚Üê CONNECTED
    .SLOW(slow_sel[AREA1PADS - 1:0]),            // ‚Üê CONNECTED
    .HLD_OVR(holdover[AREA1PADS - 1:0]),         // ‚Üê CONNECTED
    .ANALOG_EN(analog_en[AREA1PADS - 1:0]),      // ‚Üê CONNECTED
    .ANALOG_SEL(analog_sel[AREA1PADS - 1:0]),    // ‚Üê CONNECTED
    .ANALOG_POL(analog_pol[AREA1PADS - 1:0]),    // ‚Üê CONNECTED
    .DM(dm[AREA1PADS*3 - 1:0]),
    .PAD_A_NOESD_H({analog_noesd_io[AREA1PADS - 8:0], no_connect_1a}),
    .PAD_A_ESD_0_H({analog_io[AREA1PADS - 8:0], no_connect_1b}),
    .PAD_A_ESD_1_H(),
    .IN(io_in[AREA1PADS - 1:0]),
    .IN_H(io_in_3v3[AREA1PADS - 1:0]),
    .TIE_HI_ESD(loop1_io[AREA1PADS - 1:0]),
    .TIE_LO_ESD(loop0_io[AREA1PADS - 1:0])
);
```

### NOT Working Version (`not_working_rtl_with_scl/mprj_io.v`, lines ~70-72):
```verilog
pc3b03ed_wrapper area1_io_pad [AREA1PADS - 1:0](
    .IN(io_in[AREA1PADS - 1:0]),
    .OUT(io_out[AREA1PADS - 1:0]),
    .PAD(io[AREA1PADS - 1:0]),
    .INPUT_DIS(inp_dis[AREA1PADS - 1:0]),
    .OUT_EN_N(oeb[AREA1PADS - 1:0]),
    .dm(dm[AREA1PADS*3 - 1:0])
    // ‚úó‚úó‚úó MISSING 8 CRITICAL CONNECTIONS ‚úó‚úó‚úó
);
```

---

## Why This Breaks GPIO

The missing signals control critical pad functionality:

| Signal | Purpose | Result if Missing |
|--------|---------|-------------------|
| `VTRIP_SEL` | Input voltage threshold (1.8V vs 3.3V) | Input comparator threshold undefined ‚Üí input reading unreliable |
| `IB_MODE_SEL` | Input bias mode | Input buffer behavior unpredictable |
| `SLOW` | Slew rate control | Timing issues, EMI issues |
| `HLD_OVR` | Hold-over during power ramp | Pad may not survive power transitions |
| `ANALOG_EN` | Analog mode enable | Analog features don't work |
| `ANALOG_SEL` | Analog signal selection | Analog routing fails |
| `ANALOG_POL` | Analog polarity | Analog behavior inverted/broken |
| `ENABLE_H` | High voltage domain enable | Output driver may not function |

**For GPIO test specifically:**
- GPIO test reads input values from testbench on pins [23:16]
- Without `VTRIP_SEL` connected, input comparator threshold is undefined
- Pads may not register the input signal changes
- Result: `checkbits_hi` stays 0x00, test times out

---

## The Real Question: CAN pc3b03ed_wrapper Even Support These Ports?

The SCL180 pad cell `pc3b03ed_wrapper` may or may not support these ports. Possibilities:

1. **pc3b03ed_wrapper has these ports but they're not being used**
   - Fix: Add the connections to mprj_io.v
   - Effort: Low (just wire connections)

2. **pc3b03ed_wrapper doesn't have these ports at all**
   - Fix: Find a different SCL180 pad wrapper that supports full GPIO functionality
   - Effort: Medium-High (may require architectural changes)

3. **pc3b03ed_wrapper is a simplified pad with minimal functionality**
   - Fix: Either use a more complete SCL180 pad wrapper or revert to Sky130
   - Effort: High (may require significant redesign)

---

## Conclusion

**The 8 signals ARE toggling and ARE flowing through the system. They're just not wired to the destination (the pad cells).**

This is the smoking gun üî´ - whoever adapted caravel to SCL180 did the following:
1. ‚úì Changed processor from PicoRV32 to VexRiscv
2. ‚úì Generated all the control signal logic in gpio_control_block
3. ‚úì Connected signals through caravel_core
4. ‚úó **FORGOT to wire them to the pad cell in mprj_io.v**
5. ‚úó Used a simplified pad wrapper that may not support all features anyway

**This is not a complex bug. It's a wiring mistake.**

The fix is straightforward:
- Either wire those 8 signals to the pad cell ports (if they exist)
- Or find an SCL180 pad wrapper that supports the full port interface

**Confidence: 99%** - The evidence is clear and unambiguous.
