# Core Selection: PicoRV32 vs VexRiscv

## Working Version - PicoRV32 Based (~/gits/caravel_pico)

### **mgmt_core.v Selection Mechanism:**
```verilog
// File: ~/gits/caravel_pico/verilog/rtl/mgmt_core.v
// Lines 30-40

`ifdef PICORV32_V
`error "mgmt_core.v must be read before picorv32.v!"
`endif

`define PICORV32_REGS mgmt_soc_regs

`include "picorv32.v"
`include "spimemio.v"
`include "simpleuart.v"
`include "storage.v"
`include "gpio_wb.v"
```

### **How It Works:**
1. **Conditional check:** `ifdef PICORV32_V` prevents double inclusion
2. **Register definition:** `define PICORV32_REGS mgmt_soc_regs` customizes register naming
3. **Direct include:** `include "picorv32.v"` brings in PicoRV32 processor
4. **Modular design:** Separate modules for SPI, UART, storage, GPIO

### **Advantages:**
- ✅ Lightweight (830 lines)
- ✅ Simple to understand
- ✅ Easy to modify/debug
- ✅ Each subsystem is separate and replaceable
- ✅ Can easily switch cores if needed

### **How to Switch Cores:**
You would modify the `include` line to use a different processor:
```verilog
// Option 1: Use PicoRV32 (current)
`include "picorv32.v"

// Option 2: Use VexRiscv (would require)
`include "vexriscv.v"
```

---

## Not Working Version - VexRiscv Based (not_working_rtl_with_scl)

### **mgmt_core.v Structure:**
```verilog
// File: /home/iraj/VLSI/caravel/verilog/not_working_rtl_with_scl/mgmt_core.v
// Lines 1-6

//Auto-generated by Migen (9a0be7a) & LiteX (470fc6f) on 2022-10-14 12:53:55

`include "RAM256.v"
`include "RAM128.v"
`include "VexRiscv_MinDebugCache.v"

// ... 8473 lines of hard-coded LiteX auto-generated code ...

// Line 8430:
VexRiscv VexRiscv(
    .clk(sys_clk),
    .dBusWishbone_ACK(mgmtsoc_dbus_dbus_ack),
    // ... many other signals ...
);
```

### **How It Works:**
1. **Auto-generated code:** Produced by LiteX (Python SoC generator)
2. **Hard-coded VexRiscv:** No conditional compilation, VexRiscv is directly instantiated
3. **Everything integrated:** All peripherals, interconnect, and processor in one monolithic file
4. **Hard to modify:** You can't just switch the processor - entire architecture is hardcoded

### **Disadvantages:**
- ❌ Massive (8473 lines vs 830)
- ❌ Auto-generated - difficult to debug or understand
- ❌ Hard-coded VexRiscv - NO FLEXIBILITY
- ❌ All peripherals tightly coupled
- ❌ Can't easily switch back to PicoRV32
- ❌ SCL180 adaptation baked into LiteX generation

---

## Can You Switch Back to PicoRV32?

### **Option 1: Use the Working Version Directly**
**Simplest solution:** Just use the working version from `~/gits/caravel_pico`
```bash
# Copy working mgmt_core.v and picorv32.v
cp ~/gits/caravel_pico/verilog/rtl/mgmt_core.v /path/to/your/project/
cp ~/gits/caravel_pico/verilog/rtl/picorv32.v /path/to/your/project/
```

### **Option 2: Manual Regeneration with LiteX (If you must use SCL180)**
If you need VexRiscv with SCL180 support, you would need to:
1. Reconfigure LiteX with proper SCL180 PDK modules
2. Regenerate the core
3. This requires understanding LiteX configuration

### **Option 3: Hybrid Approach**
Replace the auto-generated `mgmt_core.v` with the PicoRV32-based one:
```bash
# Replace the not_working mgmt_core.v with working version
rm /home/iraj/VLSI/caravel/verilog/not_working_rtl_with_scl/mgmt_core.v
cp ~/gits/caravel_pico/verilog/rtl/mgmt_core.v /home/iraj/VLSI/caravel/verilog/not_working_rtl_with_scl/mgmt_core.v
cp ~/gits/caravel_pico/verilog/rtl/picorv32.v /home/iraj/VLSI/caravel/verilog/not_working_rtl_with_scl/
```

---

## Key Differences in Interface

### **PicoRV32 (Working):**
- Uses Wishbone bus for peripherals
- Simple GPIO interface via `gpio_wb.v`
- Standard SPI flash interface
- Straightforward UART

### **VexRiscv (Not Working):**
- Uses different Wishbone signal naming (mgmtsoc_dbus_*)
- Different memory interface
- Auto-generated interconnect
- Different peripheral addresses/layouts

**This is why your GPIO test fails:** The VexRiscv version generated by LiteX has **different register addresses and bus protocols** than PicoRV32, so the firmware doesn't work.

---

## Recommendation

**To fix your GPIO test:**

1. **Best solution:** Use PicoRV32 version (it works)
2. **Alternative:** If you need SCL180 support, regenerate LiteX with correct configuration
3. **Avoid:** Trying to mix-and-match - the architectures are too different

The not_working_rtl_with_scl was generated for a different purpose and isn't compatible with your firmware without significant rework.

